# Vercel Deployment Guide

## Проблема
После сканирования штрих-кода приложение не переходит на страницу продукта на Vercel.

## Решение

Были внесены следующие изменения для исправления проблемы с навигацией на Vercel:

### 1. Обновлена конфигурация Next.js (`next.config.ts`)
- Добавлена настройка для удаленных изображений с OpenFoodFacts
- Добавлена настройка `trailingSlash: false` для правильной работы динамических маршрутов

### 2. Обновлена конфигурация Vercel (`vercel.json`)
- Добавлены rewrites для динамических маршрутов `/product/:barcode`

### 3. Улучшена навигация в компоненте BarcodeScanner
- Добавлено логирование для отладки
- Добавлен prefetch перед навигацией
- Добавлен fallback на `window.location.href` если `router.push` не работает
- Используется `encodeURIComponent` для безопасной передачи штрих-кода в URL

### 4. Добавлена настройка динамического рендеринга
- В `src/app/product/[barcode]/page.tsx` добавлена настройка `export const dynamic = 'force-dynamic'`

### 5. Создан middleware (`src/middleware.ts`)
- Обеспечивает правильную обработку маршрутов на Vercel
- Добавляет необходимые CORS заголовки

## Шаги для деплоя

1. **Закоммитить изменения:**
   ```bash
   git add .
   git commit -m "Fix navigation to product page on Vercel"
   git push origin main
   ```

2. **Vercel автоматически задеплоит изменения**

3. **Проверить деплой:**
   - Откройте приложение на Vercel
   - Откройте консоль разработчика (F12)
   - Отсканируйте штрих-код
   - Проверьте логи в консоли:
     - "Barcode scanned: [код]"
     - "Scanner stopped, navigating to product page"
     - "Attempting navigation to: /product/[код]"

4. **Если проблема сохраняется:**
   - Проверьте логи в консоли браузера
   - Проверьте логи деплоя на Vercel
   - Убедитесь, что HTTPS включен (требуется для работы камеры)

## Отладка

Если навигация все еще не работает, проверьте в консоли:
- Были ли ошибки при сканировании
- Были ли ошибки при навигации
- Использовался ли fallback на `window.location.href`

## Дополнительные настройки

Если нужно изменить задержку перед навигацией, отредактируйте значение в `setTimeout` в файле `BarcodeScanner.tsx` (сейчас 100ms).

## Примечания

- Камера работает только по HTTPS (поэтому локально используется `server.js` с SSL сертификатами)
- На Vercel HTTPS настроен автоматически
- Динамические маршруты теперь правильно обрабатываются

